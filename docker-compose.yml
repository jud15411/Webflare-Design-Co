# docker-compose.yml

services:
  server:
    build:
      context: .
      dockerfile: Dockerfile.server
    # No 'ports' needed here; Nginx will handle access.
    environment:
      - NODE_ENV=development
      - MONGO_URI=${MONGO_URI}
      - JWT_SECRET=${JWT_SECRET}

  client:
    build:
      context: .
      dockerfile: Dockerfile.client
    # No 'ports' needed here; Nginx will handle access.
    depends_on:
      - server

  nginx:
    image: nginx:stable-alpine
    container_name: reverse_proxy
    ports:
      # Map host port 5000 to the Nginx container's port 80.
      # This is now the ONLY port you need to access your app.
      - '5000:80'
    volumes:
      # Mount your custom Nginx configuration.
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - client
      - server
