# docker-compose.yml

services:
  server:
    build:
      context: .
      dockerfile: Dockerfile.server
    environment:
      - NODE_ENV=development
      - MONGO_URI=${MONGO_URI}
      - JWT_SECRET=${JWT_SECRET}
      - REDIS_URL=${REDIS_URL} # <-- Add this line
    depends_on:
      - redis

  redis:
    image: redis:7-alpine
    container_name: redis_cache
    ports:
      - '6379:6379'

  # ... rest of your client, portal, and nginx services
  client:
    build:
      context: .
      dockerfile: Dockerfile.client
    depends_on:
      - server

  portal:
    build:
      context: .
      dockerfile: Dockerfile.portal
    depends_on:
      - server

  nginx:
    image: nginx:stable-alpine
    container_name: reverse_proxy
    ports:
      - '5000:80'
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - client
      - portal
      - server
